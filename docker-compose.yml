version: '3.1'
services:
  app:
    build: .
    environment:
      - UH_DATABASE_NAME=uhsimulator
      - UH_DATABASE_USERNAME=sa
      - UH_DATABASE_PASSWORD=Rooty-Tooty
      - UH_DATABASE_HOST=universal_housing_simulator
      - UH_DATABASE_PORT=1433
      - REDIS_URL=redis:6379
    ports:
      - 3000:3000
    links:
      - universal_housing_simulator
    volumes:
      - .:/app
    command: sh -c 'rails db:migrate && rails s'
  universal_housing_simulator:
    image: 775052747630.dkr.ecr.eu-west-2.amazonaws.com/hackney/universal-housing-simulator:9855e4d527519516e8138a026e900ae26b4be5f3
    ports:
      - 1433:1433

  redis:
    image: redis:5.0.3-alpine
    command: ["redis-server", "--appendonly", "yes"]
    hostname: redis
    ports:
      - 6379:6379
