#!/usr/bin/env ruby
require File.expand_path(File.join(File.dirname(__FILE__), '..', 'config', 'environment'))
require 'delayed/command'
require 'securerandom'

# this stops workers running other docker containers from picking up the same job,
# however jobs left locked on SIGKILL will be ignored for 4 hours
uuid_prefix = '--prefix=' + SecureRandom.uuid

queues = [
  '--pool=*:1'
  # this is currency being used with the 'run' command,
  # this seems to disable separate threads. Therefore until jobs are run using 'start' we can not use separate worker queues
]

params = [uuid_prefix] + queues + ARGV
puts params
Delayed::Command.new(params).daemonize
